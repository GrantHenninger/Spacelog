{% extends "base.html" %}
{% load missiontime %}

{% block title %}Transcript - Starting at {{ log_lines.0.timestamp|mission_time_format }}{% endblock %}

{% block content-class %}transcript{% endblock %}

{% block content %}

  {% if previous_timestamp %}
    <a href="{% timestamp_to_url previous_timestamp %}">Previous</a>
  {% endif %}

  <dl id='transcript'{% if max_highlight_index > 0 %} class='with-highlight'{% endif %}>
  {% for log_line in log_lines %}
    {% for speaker, text in log_line.lines %}
    <dt{% if log_line.highlighted %} class='highlighted'{% endif %}>
      <a href='{% selection_url log_line.timestamp %}'>
        <time datetime="{{ log_line.utc_time|date:"Y-m-d\TH:i:s\Z" }}">
          {{log_line.timestamp|mission_time_format}}
        </time>
      </a>
    </dt>
    <dt{% if log_line.highlighted %} class='highlighted'{% endif %}>{{speaker}}</dt>
    <dd{% if log_line.highlighted %} class='highlighted'{% endif %}>
      {{text|safe}}
      {% if log_line.highlight_index == 0 and log_line.previous_timestamp %}
        <a href='{% selection_url log_line.previous_timestamp selection_end_timestamp %}'>Expand selection up</a>
      {% endif %}
      {% if log_line.highlight_index == 0 and log_line.next_timestamp and log_line.next_timestamp <= selection_end_timestamp %}
        <a href='{% selection_url log_line.next_timestamp selection_end_timestamp %}'>Contract selection down</a>
      {% endif %}

      {% if log_line.highlight_index == max_highlight_index and log_line.next_timestamp %}
        <a href='{% selection_url selection_start_timestamp log_line.next_timestamp %}'>Expand selection down</a>
      {% endif %}
      {% if log_line.highlight_index == max_highlight_index and log_line.previous_timestamp and log_line.previous_timestamp >= selection_start_timestamp %}
        <a href='{% selection_url selection_start_timestamp log_line.previous_timestamp %}'>Contract selection up</a>
      {% endif %}
    </dd>
    {% endfor %}
  {% endfor %}
  </dl>

  {% if next_timestamp %}
    <a href="{% timestamp_to_url next_timestamp %}">Next</a>
  {% endif %}

<h2>Phases</h2>
<ol>
  {% for act in acts %}
    {% if act == current_act %}
      <li><strong>You are here: <a href="{% timestamp_to_url act.start %}">{{ act.title }}</a></strong></li>
    {% else %}
      <li><a href="{% timestamp_to_url act.start %}">{{ act.title }}</a></li>
    {% endif %}
  {% endfor %}
</ol>

{% endblock %}

